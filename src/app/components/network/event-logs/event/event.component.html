@let data = event.data; @let block = data?.block;
<div
  class="py-1 flex flex-col gap-1"
  [ngClass]="{
    'text-green-400':
      event.state === 'completed' &&
      (event.type === 'block-validated' ||
        event.type === 'block-mined' ||
        event.type === 'peer-connected' ||
        event.type === 'peer-search-complete'),
    'text-red-400':
      event.state === 'failed' ||
      (event.state === 'completed' &&
        (event.type === 'block-rejected' ||
          event.type === 'peer-disconnected')),
    'text-blue-400':
      event.state === 'processing' ||
      (event.state === 'completed' &&
        (event.type === 'block-received' || event.type === 'peer-search')),
    'text-yellow-400': event.type === 'sync-progress'
  }"
>
  <!-- Header -->
  <div>
    <span class="font-mono mr-1">{{
      event.timestamp | date : "shortTime"
    }}</span>
    <span *ngIf="data?.peerId && data?.peerId !== event.minerId"
      >[peer: {{ data?.peerId }}]</span
    >
    <span *ngIf="event.type === 'block-validated'"> ✔️ Bloco validado </span>
    <span *ngIf="event.type === 'block-rejected'"> ❌ Bloco rejeitado </span>
    <span *ngIf="event.type === 'block-received'">⬇️ Bloco recebido</span>
    <span *ngIf="event.type === 'sync-progress'">🔄 Sincronização</span>
    <span *ngIf="event.type === 'block-mined'">⛏️ Bloco minerado</span>
    <span *ngIf="event.type === 'peer-disconnected'">🚫 Peer desconectado</span>
    <span *ngIf="event.type === 'peer-connected'">🔗 Peer conectado</span>
    <span
      *ngIf="
        event.type === 'peer-search' || event.type === 'peer-search-complete'
      "
      >🌐 Busca por peers</span
    >
    <span *ngIf="event.state === 'processing'" class="inline-flex items-center">
      <span class="animate-spin ml-1"
        ><svg class="w-3 h-3" viewBox="0 0 24 24">
          <circle
            class="opacity-25"
            cx="12"
            cy="12"
            r="10"
            stroke="currentColor"
            stroke-width="3"
            fill="none"
          />
          <path
            class="opacity-75"
            fill="currentColor"
            d="M4 12a8 8 0 018-8v4a4 4 0 00-4 4H4z"
          />
        </svg>
      </span>
    </span>
  </div>
  <!-- Body -->
  <div>
    <div class="ml-1 flex items-center gap-1.5" *ngIf="block">
      <span class="text-blue-400 font-semibold text-xs"
        >#{{ block.height }}</span
      >
      <span class="text-zinc-400 text-xs">•</span>
      <span class="font-mono text-zinc-400 text-xs tracking-tight">
        {{ block.hash | slice : 0 : 32 }}...
      </span>
      <span class="text-zinc-400 text-xs">•</span>
      <span class="text-purple-400 text-xs italic"
        >v{{ block.consensusVersion || "-" }}</span
      >
    </div>
    <span *ngIf="!block" class="ml-1 flex items-center gap-2 text-zinc-400"
      >{{ event.message }}
    </span>
  </div>
  <!-- Sublines -->
  <div
    *ngFor="let line of event.lines"
    class="ml-1 flex items-center gap-3"
    [ngClass]="{
      'text-green-400':
        line.state === 'completed' &&
        (line.type === 'block-validated' ||
          line.type === 'block-mined' ||
          line.type === 'peer-connected' ||
          line.type === 'peer-search-complete'),
      'text-red-400':
        line.state === 'failed' ||
        (line.state === 'completed' &&
          (line.type === 'block-rejected' ||
            line.type === 'peer-disconnected')),
      'text-blue-400':
        line.state === 'processing' ||
        (line.state === 'completed' &&
          (line.type === 'block-received' || line.type === 'peer-search')),
      'text-yellow-400': line.type === 'sync-progress'
    }"
  >
    <span class="font-mono">
      {{ line.timestamp | date : "HH:mm:ss" }}
    </span>
    <span>{{ line.message }}</span>
    <span
      *ngIf="line.state === 'processing'"
      class="inline-flex items-center justify-center animate-spin"
    >
      <svg class="w-4 h-4" viewBox="0 0 24 24">
        <circle
          class="opacity-25"
          cx="12"
          cy="12"
          r="10"
          stroke="currentColor"
          stroke-width="4"
          fill="none"
        />
        <path
          class="opacity-75"
          fill="currentColor"
          d="M4 12a8 8 0 018-8v4a4 4 0 00-4 4H4z"
        />
      </svg>
    </span>
  </div>
</div>
