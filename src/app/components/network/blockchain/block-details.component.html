<div class="min-h-screen bg-zinc-950 text-zinc-100">
  <div
    class="bg-zinc-900 border-b border-zinc-800 px-6 py-4 flex items-center justify-between gap-4"
  >
    <!-- Botão Voltar -->
    <button
      (click)="onClose()"
      class="text-zinc-400 hover:text-red-400 text-xl font-bold flex-shrink-0"
      title="Voltar"
    >
      <i class="pi pi-times"></i>
    </button>
    <!-- Título Centralizado -->
    <div class="flex-1 flex flex-col items-center">
      <div class="text-lg font-bold text-blue-300 leading-tight">
        Bloco Bitcoin
      </div>
      <div class="font-mono text-base text-zinc-200 break-all">
        #{{ block.height }}
      </div>
      <div class="font-mono text-xs text-zinc-400 break-all mt-1">
        Hash: {{ block.hash }}
      </div>
    </div>
    <!-- Navegação Prev/Next -->
    <div class="flex items-center gap-2">
      <button
        class="p-1.5 rounded-full bg-zinc-800 border border-zinc-700 text-zinc-400 hover:text-blue-400 hover:bg-zinc-700 transition disabled:opacity-40"
        [disabled]="!hasPrevBlock"
        (click)="goPrevBlock.emit()"
        title="Bloco anterior"
      >
        <i class="pi pi-angle-left text-lg"></i>
      </button>
      <button
        class="p-1.5 rounded-full bg-zinc-800 border border-zinc-700 text-zinc-400 hover:text-blue-400 hover:bg-zinc-700 transition disabled:opacity-40"
        [disabled]="!hasNextBlock"
        (click)="goNextBlock.emit()"
        title="Próximo bloco"
      >
        <i class="pi pi-angle-right text-lg"></i>
      </button>
    </div>
  </div>

  <div class="container mx-auto px-6 py-8" *ngIf="block">
    <!-- Informações do Bloco -->
    <div class="bg-zinc-900 rounded-lg border border-zinc-700 p-6 mb-8 w-full">
      <h3 class="text-lg font-semibold text-zinc-200 mb-4">
        Informações do Bloco
      </h3>
      <div
        class="grid grid-cols-[max-content_1fr] gap-x-4 gap-y-1 items-baseline"
      >
        <div class="text-zinc-500">Altura:</div>
        <div class="font-mono text-zinc-200">{{ block.height }}</div>
        <div class="text-blue-400 font-semibold">Hash:</div>
        <div class="font-mono break-all text-blue-300">0x{{ block.hash }}</div>
        <div class="text-yellow-400 font-semibold">Target:</div>
        <div class="font-mono break-all text-yellow-300">
          0x{{ block.target.toString(16).padStart(64, "0") }}
        </div>
        <div class="col-span-2 text-xs text-zinc-400 mb-2">
          O hash do bloco deve ser menor que o target para ser válido.
        </div>
        <div class="text-zinc-500">Timestamp:</div>
        <div class="font-mono text-zinc-400">
          {{ block.timestamp | date : "medium" }}
        </div>
        <div class="text-zinc-500">Minerador:</div>
        <div class="font-mono text-zinc-400">{{ block.minerId ?? "-" }}</div>
        <div class="text-zinc-500">nBits:</div>
        <div class="font-mono text-zinc-400">{{ block.nBits }}</div>
        <div class="text-zinc-500">Merkle Root:</div>
        <div class="font-mono break-all text-zinc-500">
          {{ block.merkleRoot }}
        </div>
        <div class="text-zinc-500">Versão Consenso:</div>
        <div class="font-mono text-zinc-400">v{{ block.consensusVersion }}</div>
        <div class="text-zinc-500">Nonce:</div>
        <div class="font-mono text-zinc-400">{{ block.nonce }}</div>
        <div class="text-zinc-500">Previous Hash:</div>
        <div class="font-mono break-all text-zinc-500">
          {{ block.previousHash }}
        </div>
      </div>
    </div>
    <!-- Transações -->
    <div class="bg-zinc-900 rounded-lg border border-zinc-700 p-6 w-full">
      <div #transactionsTop class="scroll-margin-top"></div>
      <h3 class="text-lg font-semibold text-zinc-200 mb-4">
        Transações
        <span class="text-blue-400">({{ block.transactions.length }})</span>
      </h3>
      <div *ngIf="block.transactions.length > 0; else noTxs">
        <div class="space-y-6">
          <div
            *ngFor="let tx of pagedTransactions; let i = index"
            class="bg-zinc-800 rounded p-4 border border-zinc-700 relative flex flex-col gap-2"
          >
            <div
              class="flex items-center gap-2 mb-2 px-2 py-1 rounded bg-zinc-900/80 border border-zinc-700"
            >
              <span
                class="text-blue-400 font-bold text-sm flex items-center gap-1"
              >
                <i class="pi pi-hashtag text-xs"></i> Tx #{{
                  getGlobalTxIndex(i)
                }}
              </span>
              <span
                class="font-mono text-xs text-blue-300 truncate max-w-[220px] ml-2"
                >{{ tx.id }}</span
              >
              <button
                class="ml-1 p-1 rounded-full hover:bg-blue-900/40 transition"
                (click)="$event.stopPropagation(); copyToClipboard(tx.id)"
                title="Copiar TxID"
              >
                <i class="pi pi-copy text-xs text-blue-400"></i>
              </button>
              <span
                *ngIf="getGlobalTxIndex(i) === 0"
                class="ml-3 px-2 py-0.5 rounded-full bg-yellow-400 text-yellow-900 text-xs font-bold flex items-center gap-1 shadow"
              >
                <i class="pi pi-gift"></i> COINBASE
              </span>
            </div>
            <div
              class="flex flex-col md:flex-row gap-4 items-stretch justify-between"
            >
              <!-- Inputs -->
              <div class="flex-1 min-w-0">
                <div class="text-xs text-zinc-400 mb-1">Inputs</div>
                <div
                  *ngIf="tx.inputs.length === 0"
                  class="text-zinc-500 italic text-xs"
                >
                  Coinbase
                </div>
                <div class="flex flex-col gap-2">
                  <ng-container *ngFor="let input of tx.inputs">
                    <app-utxo
                      [value]="input.value"
                      [address]="input.scriptPubKey.address"
                      [txid]="input.txid"
                      [vout]="input.vout"
                      [scriptSig]="input.scriptSig"
                      [isSpent]="true"
                      [context]="'input'"
                      [compact]="true"
                      [blockHeight]="input.blockHeight"
                      [isWallet]="isWalletAddress(input.scriptPubKey.address)"
                    ></app-utxo>
                  </ng-container>
                </div>
              </div>
              <!-- Arrow -->
              <div class="flex flex-col items-center justify-center mx-2">
                <i class="pi pi-arrow-right text-2xl text-zinc-400"></i>
              </div>
              <!-- Outputs -->
              <div class="flex-1 min-w-0">
                <div class="text-xs text-zinc-400 mb-1">Outputs</div>
                <div class="flex flex-col gap-2">
                  <ng-container
                    *ngFor="let output of tx.outputs; let j = index"
                  >
                    <app-utxo
                      [value]="output.value"
                      [address]="output.scriptPubKey.address"
                      [txid]="tx.id"
                      [vout]="j"
                      [isSpent]="false"
                      [context]="'output'"
                      [compact]="true"
                      [isCoinbase]="getGlobalTxIndex(i) === 0"
                      [blockHeight]="block.height"
                      [isWallet]="isWalletAddress(output.scriptPubKey.address)"
                      [isChange]="isChangeOutput(tx, j)"
                    ></app-utxo>
                  </ng-container>
                </div>
              </div>
            </div>
          </div>
        </div>
        <app-pagination-bar
          *ngIf="totalPages > 1"
          [currentPage]="toNumber(currentPage)"
          [totalPages]="toNumber(totalPages)"
          [percent]="pagePercent"
          [prevDisabled]="prevDisabled"
          [nextDisabled]="nextDisabled"
          (goToFirst)="goToFirstPage()"
          (goToPrevious)="goToPreviousPage()"
          (goToNext)="goToNextPage()"
          (goToLast)="goToLastPage()"
          (jumpToPage)="jumpToPage($event)"
        ></app-pagination-bar>
      </div>
      <ng-template #noTxs>
        <div class="text-zinc-500 italic">Nenhuma transação neste bloco.</div>
      </ng-template>
    </div>
  </div>
</div>
