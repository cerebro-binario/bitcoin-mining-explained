<div class="relative">
  <div class="overflow-x-auto pb-4">
    <div
      id="miners-panel-container"
      class="flex flex-row gap-16 items-stretch px-16"
    >
      <!-- Bloco atual -->
      <ng-container *ngFor="let nodes of miner.heights; let height = index">
        @if(nodes[0].block.height === -1) { @let nChains =
        nodes[0].children.length;
        <div
          class="relative flex flex-col"
          @blockAnimation
          [@slideRightAnimation]="{
            value: miner.isAddingBlock ? 'moved' : 'default',
            params: { slideXValue }
          }"
        >
          <div
            *ngIf="nChains > 1"
            [id]="'originBlock-' + miner.id"
            class="w-5 h-5 bg-zinc-500 rounded-full"
            [ngStyle]="{
                  transform: getOriginBlockTransform(nChains),
                }"
          ></div>
        </div>
        } @else { @let h = miner.getHeightIndex(height);
        <div
          class="relative height-element"
          @blockAnimation
          [@slideRightAnimation]="{
            value: miner.isAddingBlock ? 'moved' : 'default',
            params: { slideXValue }
          }"
        >
          <div
            class="relative py-2 flex flex-col gap-4 height-element-container"
          >
            <div
              *ngFor="let node of nodes"
              class="relative block-element rounded-lg p-4 border w-72 shadow transition-transform cursor-pointer group flex flex-col"
              [ngClass]="[
                getBlockBackgroundColor(node),
                getBlockBorderColor(node)
              ]"
            >
              <div class="flex items-center justify-between mb-1">
                <div class="flex items-center gap-2">
                  <span
                    class="font-semibold text-blue-300 text-base flex items-center gap-2"
                  >
                    #{{ h }}
                  </span>
                  <span class="text-xs text-zinc-400">{{
                    node.block.timestamp | date : "shortTime"
                  }}</span>
                </div>
                <div class="flex items-center gap-2">
                  <span
                    *ngIf="node.block.miningElapsed"
                    class="text-xs text-zinc-400 bg-zinc-900/50 rounded px-2 py-0.5"
                    >⏱️
                    {{ (node.block.miningElapsed / 1000).toFixed(1) }}s</span
                  >
                  <span
                    *ngIf="node.block.minerId"
                    class="text-xs text-blue-400 bg-blue-900/50 rounded px-2 py-0.5"
                    >Miner {{ node.block.minerId }}</span
                  >
                  <span
                    class="text-xs text-purple-400 bg-purple-900/50 rounded px-2 py-0.5"
                    >v{{ node.block.consensusVersion }}</span
                  >
                </div>
              </div>
              <div class="border-b border-zinc-700 my-1"></div>
              <div class="mb-1">
                <span class="text-zinc-400">Hash:</span>
                <div class="font-mono text-xs text-zinc-300 break-all">
                  {{ node.block.hash }}
                </div>
              </div>
              <div class="mb-1">
                <span class="text-zinc-400">Anterior:</span>
                <div class="font-mono text-xs text-zinc-500 break-all">
                  {{ node.block.previousHash }}
                </div>
              </div>
              <div class="flex items-center justify-between mt-1">
                <div class="flex items-center gap-1">
                  <span class="text-zinc-400">Txs:</span>
                  <span class="font-mono text-xs text-zinc-300">{{
                    node.block.transactions.length
                  }}</span>
                </div>
                <div class="flex items-center gap-1">
                  <span class="text-zinc-400">Nonce:</span>
                  <span class="font-mono text-xs text-zinc-300">{{
                    node.block.nonce | number
                  }}</span>
                </div>
              </div>

              <!-- Conexões -->
              @if(node.parent) {
              <div
                class="absolute bg-zinc-500 text-xs w-2.5 h-2.5 rounded-lg right-0 top-1/2 -translate-y-1/2 translate-x-1/2 z-10"
                [ngStyle]="{
                  'clip-path': 'polygon(50% 0%, 100% 0%, 100% 100%, 50% 100%)'
                }"
              ></div>
              <svg
                *ngIf="
                  node.parent.block.height !== -1 ||
                  node.parent.children.length > 1
                "
                class="absolute h-full w-full top-0 right-0 bottom-0 left-0 pointer-events-none overflow-visible"
              >
                <path
                  [attr.d]="getCurvedPath(miner, node, height)"
                  [attr.stroke]="
                    getConnectionStrokeColor(node, isHeightResolved(height))
                  "
                  stroke-width="2"
                  fill="transparent"
                />
              </svg>
              } @if(node.children.length === 0) {
              <div
                class="absolute w-3 h-3 -left-6 top-1/2 -translate-y-1/2 -translate-x-1/2 bg-zinc-400"
              ></div>
              <div
                class="absolute w-6 h-0.5 -left-6 top-1/2 -translate-y-1/2 bg-zinc-400"
              ></div>
              } @else {
              <div
                *ngFor="let child of node.children; let i = index"
                class="absolute bg-zinc-500 text-xs w-2.5 h-2.5 rounded-lg left-0 -translate-y-1/2 -translate-x-1/2 z-10"
                [ngStyle]="{
                  top:
                    'calc(' +
                    getDynamicTopValue(node.children.length, i) +
                    '%)',
                  'clip-path': 'polygon(0% 0%, 50% 0%, 50% 100%, 0% 100%)'
                }"
              ></div>
              }
            </div>
          </div>
        </div>
        }
      </ng-container>
    </div>
  </div>
</div>
