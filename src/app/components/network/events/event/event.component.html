@let data = event.data; @let block = data?.block; @let visual = event.type |
eventLogVisual;
<div class="py-1 flex flex-col gap-1" [ngClass]="visual.color">
  <!-- Header -->
  <div>
    <span class="font-mono mr-2 text-zinc-400">{{
      event.timestamp | date : "HH:mm:ss"
    }}</span>
    <i [class]="visual.icon + ' mr-2 text-xs'"></i>
    <span>{{ event.type | eventLogMessage : event.data }}</span>
    <!-- <span *ngIf="data?.peerId && data?.peerId !== event.minerId">
      [peer #{{ data?.peerId }}]</span
    > -->
    <span *ngIf="event.state === 'pending'" class="inline-flex items-center">
      <span class="animate-spin ml-1"
        ><svg class="w-3 h-3" viewBox="0 0 24 24">
          <circle
            class="opacity-25"
            cx="12"
            cy="12"
            r="10"
            stroke="currentColor"
            stroke-width="3"
            fill="none"
          />
          <path
            class="opacity-75"
            fill="currentColor"
            d="M4 12a8 8 0 018-8v4a4 4 0 00-4 4H4z"
          />
        </svg>
      </span>
    </span>
  </div>
  <!-- Body -->
  <div>
    <div class="ml-4 flex items-center gap-1.5" *ngIf="block">
      <ng-container *ngFor="let part of block | blockInfoParts">
        <span [ngClass]="part.class" class="event-block-part">{{
          part.value
        }}</span>
      </ng-container>
    </div>
    <!-- Mini-template para transação -->
    <div class="ml-4 flex flex-col gap-1.5" *ngIf="event.data?.tx">
      <!-- Card visual para transação -->
      <div
        class="relative rounded-lg border-l-4 border-yellow-400 bg-zinc-900/80 shadow p-4 flex flex-col gap-3 my-2"
      >
        <!-- TxID -->
        <div class="flex items-center gap-2">
          <span class="text-zinc-400 text-xs">TxID:</span>
          <span
            class="font-mono text-green-300 truncate max-w-[200px]"
            [title]="event.data.tx.id"
          >
            {{ event.data.tx.id | slice : 0 : 16 }}...{{
              event.data.tx.id | slice : -6
            }}
          </span>
          <button
            (click)="copyToClipboard(event.data.tx.id)"
            class="ml-1 text-zinc-400 hover:text-green-400"
            title="Copiar TxID"
          >
            <i class="pi pi-copy"></i>
          </button>
        </div>
        <!-- Valor total -->
        <div class="flex items-center gap-2">
          <i class="pi pi-bitcoin text-yellow-400"></i>
          <span class="text-zinc-400 text-xs">Valor total:</span>
          <span class="font-mono text-yellow-300">
            {{ txTotalOutput(event.data.tx) / 100000000 | number : "1.8-8" }}
            <span class="text-base text-yellow-200">BTC</span>
          </span>
        </div>
        <!-- Inputs e Outputs visualmente -->
        <div
          class="flex flex-col md:flex-row gap-4 items-start justify-between mt-2"
        >
          <!-- Inputs -->
          <div class="flex-1">
            <div class="flex items-center gap-1 mb-1">
              <i class="pi pi-arrow-down text-red-400"></i>
              <span class="text-zinc-400 text-xs"
                >De ({{ event.data.tx.inputs?.length }})</span
              >
            </div>
            <div class="flex flex-col gap-1">
              <span
                *ngFor="let input of event.data.tx.inputs"
                class="font-mono text-green-400 truncate max-w-[180px] bg-zinc-800/60 rounded px-2 py-1"
                [title]="input.scriptPubKey.address"
              >
                {{ input.scriptPubKey.address }}
              </span>
            </div>
          </div>
          <!-- Seta visual -->
          <div class="flex items-center justify-center mx-2">
            <i class="pi pi-arrow-right text-zinc-500 text-2xl"></i>
          </div>
          <!-- Outputs -->
          <div class="flex-1">
            <div class="flex items-center gap-1 mb-1">
              <i class="pi pi-arrow-up text-green-400"></i>
              <span class="text-zinc-400 text-xs"
                >Para ({{ event.data.tx.outputs?.length }})</span
              >
            </div>
            <div class="flex flex-col gap-1">
              <span
                *ngFor="let output of event.data.tx.outputs"
                class="font-mono text-blue-400 truncate max-w-[180px] bg-zinc-800/60 rounded px-2 py-1"
                [title]="output.scriptPubKey.address"
              >
                {{ output.scriptPubKey.address }}
              </span>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  <!-- Logs -->
  <div class="relative ml-4">
    <ng-container *ngFor="let log of event.logs; let last = last">
      <div class="flex items-start relative py-1">
        <!-- Linha vertical da timeline -->
        <div
          *ngIf="!last"
          class="absolute left-0 h-full w-0.5 bg-zinc-700"
        ></div>
        <!-- Dot da timeline -->
        <div
          class="absolute left-0 w-3 h-1/2 border-l-2 border-b-2 border-zinc-700 rounded-bl"
        ></div>
        <!-- Conteúdo do log -->
        <div class="ml-6 w-full">
          <app-event-log [log]="log" [event]="event"></app-event-log>
        </div>
      </div>
    </ng-container>
  </div>
</div>
