<div
  class="fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50 backdrop-blur"
  (click)="onBackdropClick($event)"
>
  <div
    class="bg-zinc-800 rounded-lg shadow-lg pt-6 min-w-[320px] max-w-[90vw] w-full max-h-[95vh] h-full flex flex-col"
  >
    <button
      class="absolute top-2 right-2 text-zinc-400 hover:text-red-400"
      (click)="onClose()"
      title="Fechar"
    >
      <i class="pi pi-times text-lg"></i>
    </button>
    <h2
      class="text-lg font-bold text-blue-400 mb-4 px-6 flex items-center gap-4"
    >
      Endereços, Saldos e UTXOs
      <span
        class="text-xs font-semibold text-zinc-300 bg-zinc-700 rounded px-2 py-1"
        *ngIf="node"
      >
        Nó #{{ node.id
        }}<ng-container *ngIf="node.name"> — {{ node.name }}</ng-container>
      </span>
    </h2>
    <div class="px-6 mb-2 text-sm text-blue-200/80">
      <span class="font-semibold">Dica:</span> Veja abaixo a relação entre
      chaves, endereços e saldos.
      <span class="text-green-300"
        >Apenas endereços pertencentes a esse nó exibem as chaves
        correspondentes</span
      >.
    </div>

    <div class="mb-4 flex flex-col md:flex-row gap-2 md:items-center px-6">
      <p-selectButton
        [options]="displayModeOptions"
        [(ngModel)]="displayMode"
        (onChange)="onDisplayModeChange()"
        optionLabel="label"
        optionValue="value"
        class="w-full md:w-auto"
      ></p-selectButton>
    </div>

    <div class="flex-1 flex flex-col min-h-0">
      <div class="flex-1 min-h-0 flex flex-col px-6">
        <app-address-list
          [addresses]="addresses"
          addressType="bip84"
          [pagination]="pagination"
          [onlyWithBalance]="displayMode === 'with-balance'"
          class="h-full"
        ></app-address-list>
      </div>
      <div
        *ngIf="totalPagesDisplay > 1"
        class="flex flex-col md:flex-row md:items-center justify-between gap-4 px-6 py-4 bg-zinc-900 rounded-b-lg border-t border-zinc-700 mt-2"
      >
        <!-- Indicador de página atual -->
        <div
          class="flex flex-1 items-center justify-start gap-2 text-white/80 text-sm font-mono"
        >
          <span class="text-zinc-400">Página</span>
          <span class="font-bold text-blue-300">#{{ currentPageDisplay }}</span>
          <span class="text-zinc-400">of</span>
          <span class="font-bold text-blue-300">{{ totalPagesDisplay }}</span>
          <span class="text-zinc-500"
            >({{ pagePercent | number : "1.0-2" }}%)</span
          >
        </div>

        <!-- Botões de navegação -->
        <div class="flex flex-1 items-center justify-center gap-1">
          <button
            pButton
            icon="pi pi-angle-double-left"
            class="p-button-sm p-button-rounded p-button-text text-zinc-400 hover:text-blue-400"
            (click)="goToFirstPage()"
            [disabled]="prevDisabled"
            [ngClass]="{ 'opacity-50': prevDisabled }"
            title="Primeira página"
          ></button>
          <button
            pButton
            icon="pi pi-angle-left"
            class="p-button-sm p-button-rounded p-button-text text-zinc-400 hover:text-blue-400"
            (click)="goToPreviousPage()"
            [disabled]="prevDisabled"
            [ngClass]="{ 'opacity-50': prevDisabled }"
            title="Página anterior"
          ></button>
          <button
            pButton
            icon="pi pi-refresh"
            class="p-button-sm p-button-rounded p-button-text text-zinc-400 hover:text-blue-400"
            (click)="goToRandomPage()"
            title="Página aleatória"
          ></button>
          <button
            pButton
            icon="pi pi-angle-right"
            class="p-button-sm p-button-rounded p-button-text text-zinc-400 hover:text-blue-400"
            (click)="goToNextPage()"
            [disabled]="nextDisabled"
            [ngClass]="{ 'opacity-50': nextDisabled }"
            title="Próxima página"
          ></button>
          <button
            pButton
            icon="pi pi-angle-double-right"
            class="p-button-sm p-button-rounded p-button-text text-zinc-400 hover:text-blue-400"
            (click)="goToLastPage()"
            [disabled]="nextDisabled"
            [ngClass]="{ 'opacity-50': nextDisabled }"
            title="Última página"
          ></button>
        </div>

        <!-- Input para pular para página -->
        <form
          class="flex flex-1 items-center justify-end gap-2"
          (submit)="jumpToPage(); $event.preventDefault()"
          autocomplete="off"
        >
          <input
            type="text"
            [(ngModel)]="jumpPageInput"
            name="jumpPageInput"
            placeholder="Página #"
            class="flex-1 bg-zinc-800 border border-zinc-700 rounded px-2 py-1 text-sm text-white font-mono w-24 focus:outline-none focus:border-blue-400"
            style="min-width: 120px"
          />
          <button
            pButton
            type="submit"
            icon="pi pi-arrow-right"
            class="p-button-sm p-button-rounded p-button-text text-blue-400"
            label="Ir para"
            style="min-width: 60px"
          ></button>
        </form>
      </div>
    </div>
  </div>
</div>
