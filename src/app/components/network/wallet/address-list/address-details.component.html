<div class="min-h-screen bg-zinc-950 text-zinc-100">
  <div class="bg-zinc-900 border-b border-zinc-800 px-6 py-4">
    <div class="flex items-center gap-4 mt-4">
      <a
        [routerLink]="['/miners', nodeId]"
        class="text-zinc-400 hover:text-red-400 text-xl font-bold flex-shrink-0"
        title="Voltar para o minerador"
      >
        <i class="pi pi-times"></i>
      </a>
      <div>
        <div class="text-lg font-bold text-blue-300 leading-tight">
          Endereço Bitcoin
        </div>
        <div class="font-mono text-base text-zinc-200 break-all">
          {{ addressId }}
        </div>
      </div>
    </div>
  </div>

  <!-- Content -->
  <div class="container mx-auto px-6 py-8" *ngIf="addressData">
    <!-- Endereço -->
    <div class="mb-8">
      <div class="text-sm text-zinc-500 mb-2">Endereço</div>
      <div
        class="font-mono break-all flex items-center gap-3 p-4 bg-zinc-900 rounded-lg border border-zinc-700"
      >
        <div
          class="flex-1 bg-zinc-800/50 rounded p-2 font-mono text-sm break-all"
          [class.text-green-300]="addressData.bipFormat === 'bip44'"
          [class.text-blue-300]="addressData.bipFormat === 'bip49'"
          [class.text-purple-300]="addressData.bipFormat === 'bip84'"
        >
          {{ addressData.address }}
        </div>
        <div
          class="flex items-center gap-2 text-xs text-zinc-400"
          *ngIf="addressData.bipFormat"
        >
          <i
            class="pi pi-info-circle"
            [class.text-green-300]="addressData.bipFormat === 'bip44'"
            [class.text-blue-300]="addressData.bipFormat === 'bip49'"
            [class.text-purple-300]="addressData.bipFormat === 'bip84'"
          ></i>
          <span
            [class.text-green-300]="addressData.bipFormat === 'bip44'"
            [class.text-blue-300]="addressData.bipFormat === 'bip49'"
            [class.text-purple-300]="addressData.bipFormat === 'bip84'"
          >
            {{
              addressData.bipFormat === "bip44"
                ? "Legacy"
                : addressData.bipFormat === "bip49"
                ? "SegWit"
                : "Native SegWit"
            }}
          </span>
        </div>
        <button
          type="button"
          class="p-2 text-zinc-400 hover:text-blue-400 transition-colors"
          (click)="copyToClipboard(addressData.address)"
          title="Copiar endereço"
        >
          <i class="pi pi-copy"></i>
        </button>
      </div>
    </div>

    <!-- Chaves -->
    <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-8">
      <!-- Chave Privada -->
      <div class="bg-zinc-900 rounded-lg border border-zinc-700 p-6">
        <h3 class="text-lg font-semibold text-zinc-200 mb-4">Chave Privada</h3>
        <div class="space-y-4">
          <div>
            <label class="block text-sm text-zinc-500 mb-2">Hex:</label>
            <div class="flex items-center gap-2">
              <input
                type="text"
                readonly
                [value]="'0x' + addressData.keys.priv.hex"
                class="flex-1 bg-zinc-800 text-green-300 font-mono text-sm rounded px-3 py-2 border border-zinc-600"
              />
              <button
                type="button"
                class="p-2 text-zinc-400 hover:text-blue-400 transition-colors"
                (click)="copyToClipboard('0x' + addressData.keys.priv.hex)"
                title="Copiar chave privada"
              >
                <i class="pi pi-copy"></i>
              </button>
            </div>
          </div>
          <div>
            <label class="block text-sm text-zinc-500 mb-2">Decimal:</label>
            <div class="flex items-center gap-2">
              <input
                type="text"
                readonly
                [value]="addressData.keys.priv.decimal"
                class="flex-1 bg-zinc-800 text-green-300 font-mono text-sm rounded px-3 py-2 border border-zinc-600"
              />
              <button
                type="button"
                class="p-2 text-zinc-400 hover:text-blue-400 transition-colors"
                (click)="copyToClipboard(addressData.keys.priv.decimal)"
                title="Copiar chave privada"
              >
                <i class="pi pi-copy"></i>
              </button>
            </div>
          </div>
          <div>
            <label class="block text-sm text-zinc-500 mb-2">WIF:</label>
            <div class="flex items-center gap-2">
              <input
                type="text"
                readonly
                [value]="addressData.keys.priv.wif"
                class="flex-1 bg-zinc-800 text-green-300 font-mono text-sm rounded px-3 py-2 border border-zinc-600"
              />
              <button
                type="button"
                class="p-2 text-zinc-400 hover:text-blue-400 transition-colors"
                (click)="copyToClipboard(addressData.keys.priv.wif)"
                title="Copiar chave privada"
              >
                <i class="pi pi-copy"></i>
              </button>
            </div>
          </div>
        </div>
      </div>

      <!-- Chave Pública -->
      <div class="bg-zinc-900 rounded-lg border border-zinc-700 p-6">
        <h3 class="text-lg font-semibold text-zinc-200 mb-4">Chave Pública</h3>
        <div class="space-y-4">
          <div>
            <label class="block text-sm text-zinc-500 mb-2">Hex:</label>
            <div class="flex items-center gap-2">
              <input
                type="text"
                readonly
                [value]="'0x' + addressData.keys.pub.hex"
                class="flex-1 bg-zinc-800 text-blue-300 font-mono text-sm rounded px-3 py-2 border border-zinc-600"
              />
              <button
                type="button"
                class="p-2 text-zinc-400 hover:text-blue-400 transition-colors"
                (click)="copyToClipboard('0x' + addressData.keys.pub.hex)"
                title="Copiar chave pública"
              >
                <i class="pi pi-copy"></i>
              </button>
            </div>
          </div>
          <div>
            <label class="block text-sm text-zinc-500 mb-2">Decimal:</label>
            <div class="flex items-center gap-2">
              <input
                type="text"
                readonly
                [value]="addressData.keys.pub.decimal"
                class="flex-1 bg-zinc-800 text-blue-300 font-mono text-sm rounded px-3 py-2 border border-zinc-600"
              />
              <button
                type="button"
                class="p-2 text-zinc-400 hover:text-blue-400 transition-colors"
                (click)="copyToClipboard(addressData.keys.pub.decimal)"
                title="Copiar chave pública"
              >
                <i class="pi pi-copy"></i>
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- UTXOs -->
    <div class="bg-zinc-900 rounded-lg border border-zinc-700 p-6 mb-8">
      <h3 class="text-lg font-semibold text-zinc-200 mb-6">UTXOs</h3>

      <!-- Abas de UTXOs -->
      <div class="flex gap-2 mb-6">
        <button
          class="px-4 py-2 rounded-t-md font-semibold focus:outline-none transition border-b-2"
          [class.text-green-300]="activeUtxoTab === 'disponiveis'"
          [class.text-zinc-400]="activeUtxoTab !== 'disponiveis'"
          [class.border-green-400]="activeUtxoTab === 'disponiveis'"
          [class.border-transparent]="activeUtxoTab !== 'disponiveis'"
          (click)="setActiveUtxoTab('disponiveis')"
        >
          UTXOs Disponíveis ({{ addressData.utxos.length }})
        </button>
        <button
          class="px-4 py-2 rounded-t-md font-semibold focus:outline-none transition border-b-2"
          [class.text-zinc-400]="activeUtxoTab !== 'gastos'"
          [class.text-zinc-300]="activeUtxoTab === 'gastos'"
          [class.border-zinc-400]="activeUtxoTab === 'gastos'"
          [class.border-transparent]="activeUtxoTab !== 'gastos'"
          (click)="setActiveUtxoTab('gastos')"
        >
          UTXOs Gastos ({{ spentUtxos.length }})
        </button>
      </div>

      <!-- UTXOs disponíveis (usando app-utxo) -->
      <div *ngIf="activeUtxoTab === 'disponiveis'">
        <div *ngIf="pagedUtxos.length > 0" class="mb-8">
          <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
            <app-utxo
              *ngFor="let utxo of pagedUtxos"
              [value]="utxo.output.value"
              [address]="utxo.output.scriptPubKey.address"
              [txid]="utxo.txId"
              [vout]="utxo.outputIndex"
              [isSpent]="false"
              [isWallet]="
                utxo.output.scriptPubKey.address === addressData.address
              "
              [isChange]="false"
              [showActions]="true"
              [blockHeight]="utxo.blockHeight"
            ></app-utxo>
          </div>
        </div>
        <div
          *ngIf="pagedUtxos.length === 0"
          class="text-zinc-500 italic text-center py-8"
        >
          Nenhum UTXO disponível para este endereço.
        </div>
        <!-- Paginação de UTXOs disponíveis -->
        <app-pagination-bar
          *ngIf="utxoTotalPagesDisplay > 1"
          [currentPage]="utxoCurrentPageDisplay"
          [totalPages]="utxoTotalPagesDisplay"
          [percent]="utxoPagePercent"
          [prevDisabled]="utxoPrevDisabled"
          [nextDisabled]="utxoNextDisabled"
          (goToFirst)="utxoGoToFirstPage()"
          (goToPrevious)="utxoGoToPreviousPage()"
          (goToNext)="utxoGoToNextPage()"
          (goToLast)="utxoGoToLastPage()"
          (jumpToPage)="utxoJumpToPage($event)"
        ></app-pagination-bar>
      </div>

      <!-- UTXOs gastos -->
      <div *ngIf="activeUtxoTab === 'gastos'">
        <div *ngIf="pagedSpentUtxos.length > 0">
          <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
            <app-utxo
              *ngFor="let utxo of pagedSpentUtxos"
              [value]="utxo.output.value"
              [address]="utxo.output.scriptPubKey.address"
              [txid]="utxo.txId"
              [vout]="utxo.outputIndex"
              [isSpent]="true"
              [isWallet]="
                utxo.output.scriptPubKey.address === addressData.address
              "
              [isChange]="false"
              [showActions]="false"
              [blockHeight]="utxo.blockHeight"
              [scriptSig]="utxo.scriptSig"
            ></app-utxo>
          </div>
        </div>
        <div
          *ngIf="pagedSpentUtxos.length === 0"
          class="text-zinc-500 italic text-center py-8"
        >
          Nenhum UTXO gasto para este endereço.
        </div>
        <!-- Paginação de UTXOs gastos -->
        <app-pagination-bar
          *ngIf="utxoTotalPagesDisplay > 1"
          [currentPage]="utxoCurrentPageDisplay"
          [totalPages]="utxoTotalPagesDisplay"
          [percent]="utxoPagePercent"
          [prevDisabled]="utxoPrevDisabled"
          [nextDisabled]="utxoNextDisabled"
          (goToFirst)="utxoGoToFirstPage()"
          (goToPrevious)="utxoGoToPreviousPage()"
          (goToNext)="utxoGoToNextPage()"
          (goToLast)="utxoGoToLastPage()"
          (jumpToPage)="utxoJumpToPage($event)"
        ></app-pagination-bar>
      </div>
    </div>

    <!-- Transações -->
    <div class="bg-zinc-900 rounded-lg border border-zinc-700 p-6">
      <h3 class="text-lg font-semibold text-zinc-200 mb-6">Transações</h3>

      <div class="flex-1 min-h-0 flex flex-col">
        <app-transaction-list
          [transactions]="pagedTransactionViews"
          [walletAddresses]="[addressData.address || '']"
          [totalTransactions]="transactionViews.length"
          [currentPage]="transactionCurrentPageDisplay"
          [pageSize]="transactionPagination.pageSize"
          [nodeId]="nodeId || null"
          class="flex-1 h-full"
        ></app-transaction-list>

        <app-pagination-bar
          *ngIf="transactionTotalPagesDisplay > 1"
          [currentPage]="transactionCurrentPageDisplay"
          [totalPages]="transactionTotalPagesDisplay"
          [percent]="transactionPagePercent"
          [prevDisabled]="transactionPrevDisabled"
          [nextDisabled]="transactionNextDisabled"
          (goToFirst)="transactionGoToFirstPage()"
          (goToPrevious)="transactionGoToPreviousPage()"
          (goToNext)="transactionGoToNextPage()"
          (goToLast)="transactionGoToLastPage()"
          (jumpToPage)="transactionJumpToPage($event)"
        ></app-pagination-bar>
      </div>
    </div>
  </div>

  <!-- Loading/Error state -->
  <div *ngIf="!addressData" class="container mx-auto px-6 py-8 text-center">
    <div class="text-zinc-500">
      <i class="pi pi-spin pi-spinner text-2xl mb-4"></i>
      <p>Carregando detalhes do endereço...</p>
    </div>
  </div>
</div>
